{
    "story_id": "US-P4-008",
    "title": "Sculpting Bridge",
    "status": "pending",
    "focus": "",
    "complexity": "normal",
    "min_iterations": 1,
    "criteria": [
        {"text": "sculpt_bridge.rs exists with SculptBridge struct and SculptTool enum (6 variants)", "done": false, "notes": ""},
        {"text": "SculptBridge wraps the existing SculptingManager from engine/src/render/sculpting.rs", "done": false, "notes": ""},
        {"text": "FaceExtrude delegates to ExtrusionOperation for face-based extrusion", "done": false, "notes": ""},
        {"text": "VertexPull delegates to VertexSelection for vertex dragging", "done": false, "notes": ""},
        {"text": "EdgePull delegates to EdgeSelection for edge dragging", "done": false, "notes": ""},
        {"text": "Smooth brush relaxes vertex positions toward neighbor average with distance falloff", "done": false, "notes": ""},
        {"text": "Smooth brush uses two-pass approach (read-then-write) to avoid asymmetric drift", "done": false, "notes": ""},
        {"text": "AddSphere stamps sphere via smooth_union from sdf_operations.rs + MarchingCubes re-meshing", "done": false, "notes": ""},
        {"text": "SubtractSphere carves via smooth_subtraction from sdf_operations.rs + MarchingCubes re-meshing", "done": false, "notes": ""},
        {"text": "Vertex colors transferred from old mesh to new mesh after re-meshing via nearest-vertex lookup", "done": false, "notes": ""},
        {"text": "Normals recomputed after smooth brush operations (area-weighted face normal accumulation)", "done": false, "notes": ""},
        {"text": "brush_radius adjustable via scroll wheel (0.1..5.0)", "done": false, "notes": ""},
        {"text": "smooth_factor adjustable via Shift+scroll (0.01..1.0)", "done": false, "notes": ""},
        {"text": "Tool switching via keys 1-6 in Stage 3", "done": false, "notes": ""},
        {"text": "mod.rs adds pub mod sculpt_bridge and routes Stage 3 input/render to SculptBridge", "done": false, "notes": ""},
        {"text": "battle_arena.rs is NOT modified", "done": false, "notes": ""},
        {"text": "cargo check passes with 0 errors for both binaries", "done": false, "notes": ""}
    ],
    "verification_commands": [
        {"cmd": "test -f /home/hungaromakker/battle_tok/src/game/asset_editor/sculpt_bridge.rs && echo EXISTS", "expect_contains": "EXISTS", "description": "sculpt_bridge.rs file exists"},
        {"cmd": "grep -c 'SculptBridge\\|SculptTool' /home/hungaromakker/battle_tok/src/game/asset_editor/sculpt_bridge.rs", "expect_gt": 0, "description": "SculptBridge and SculptTool types defined"},
        {"cmd": "grep -c 'FaceExtrude\\|VertexPull\\|EdgePull\\|Smooth\\|AddSphere\\|SubtractSphere' /home/hungaromakker/battle_tok/src/game/asset_editor/sculpt_bridge.rs", "expect_gt": 0, "description": "All six sculpt tool variants defined"},
        {"cmd": "grep -c 'smooth_union\\|smooth_subtraction' /home/hungaromakker/battle_tok/src/game/asset_editor/sculpt_bridge.rs", "expect_gt": 0, "description": "SDF boolean operations used"},
        {"cmd": "grep -c 'smooth_brush\\|build_adjacency\\|average_neighbor' /home/hungaromakker/battle_tok/src/game/asset_editor/sculpt_bridge.rs", "expect_gt": 0, "description": "Smooth brush algorithm implemented"},
        {"cmd": "grep -c 'MarchingCubes\\|generate_mesh' /home/hungaromakker/battle_tok/src/game/asset_editor/sculpt_bridge.rs", "expect_gt": 0, "description": "Marching Cubes re-meshing used"},
        {"cmd": "grep -c 'recompute_normals\\|transfer_vertex_colors\\|nearest_vertex_color' /home/hungaromakker/battle_tok/src/game/asset_editor/sculpt_bridge.rs", "expect_gt": 0, "description": "Normal recomputation and color transfer implemented"},
        {"cmd": "grep -c 'pub mod sculpt_bridge' /home/hungaromakker/battle_tok/src/game/asset_editor/mod.rs", "expect_gt": 0, "description": "sculpt_bridge module registered in mod.rs"},
        {"cmd": "grep -c 'SculptingManager' /home/hungaromakker/battle_tok/src/game/asset_editor/sculpt_bridge.rs", "expect_gt": 0, "description": "Wraps existing SculptingManager"},
        {"cmd": "cd /home/hungaromakker/battle_tok && cargo check --bin battle_editor 2>&1; echo EXIT:$?", "expect_contains": "EXIT:0", "description": "battle_editor compiles with sculpt bridge"},
        {"cmd": "cd /home/hungaromakker/battle_tok && cargo check --bin battle_arena 2>&1; echo EXIT:$?", "expect_contains": "EXIT:0", "description": "battle_arena still compiles unchanged"}
    ],
    "checklist": [
        {"item": "Read spec.md and understand sculpt bridge requirements", "done": false},
        {"item": "Create src/game/asset_editor/sculpt_bridge.rs with SculptTool enum (6 variants)", "done": false},
        {"item": "Implement SculptBridge struct with active_tool, brush_radius, smooth_factor, smooth_strength, mc_resolution", "done": false},
        {"item": "Implement build_adjacency() to build per-vertex neighbor lists from index buffer", "done": false},
        {"item": "Implement average_neighbor_positions() helper", "done": false},
        {"item": "Implement smooth_brush() with two-pass read-then-write approach and linear falloff", "done": false},
        {"item": "Implement sdf_sphere() helper for sphere signed distance", "done": false},
        {"item": "Implement approximate_mesh_sdf() or mesh_to_sdf() to convert mesh into SDF for boolean operations", "done": false},
        {"item": "Implement stamp_sphere() with smooth_union/smooth_subtraction + MarchingCubes re-meshing", "done": false},
        {"item": "Implement nearest_vertex_color() for color transfer across re-meshing", "done": false},
        {"item": "Implement recompute_normals() with area-weighted face normal accumulation", "done": false},
        {"item": "Implement handle_input() routing to each tool based on active_tool", "done": false},
        {"item": "Wire FaceExtrude/VertexPull/EdgePull to existing SculptingManager methods", "done": false},
        {"item": "Add pub mod sculpt_bridge to mod.rs and add SculptBridge field to AssetEditor", "done": false},
        {"item": "Route Stage 3 (EditorStage::Sculpt) input/render to SculptBridge in mod.rs", "done": false},
        {"item": "Add key 1-6 tool switching and scroll wheel brush_radius/smooth_factor controls", "done": false},
        {"item": "Add brush radius preview circle rendering at cursor position", "done": false},
        {"item": "Run cargo check for both binaries (battle_editor and battle_arena)", "done": false},
        {"item": "Commit changes", "done": false}
    ],
    "worker_notes": "",
    "notes_history": [],
    "iteration": 0,
    "failed_reasons": [],
    "dependencies": ["US-P4-006"],
    "commit_hash": "",
    "files_modified": [],
    "iteration_history": [],
    "learnings": [],
    "verification_rejections": 0,
    "created_at": "2026-02-06T14:00:00Z"
}
