{
    "story_id": "US-P4-006",
    "title": "Pump/Inflate Extrusion (SDF-based)",
    "status": "pending",
    "focus": "",
    "complexity": "normal",
    "min_iterations": 1,
    "criteria": [
        {"text": "extrude.rs exists at src/game/asset_editor/extrude.rs", "done": false, "notes": ""},
        {"text": "ExtrudeMethod enum defined with Pump, Linear, Lathe variants", "done": false, "notes": ""},
        {"text": "PumpProfile enum defined with Elliptical, Flat, Pointed variants", "done": false, "notes": ""},
        {"text": "ExtrudeParams struct defined with all fields (inflation, thickness, profile, mc_resolution, etc.)", "done": false, "notes": ""},
        {"text": "Extruder struct defined with mesh data fields, dirty flag, and GPU buffer handles", "done": false, "notes": ""},
        {"text": "min_distance_to_polygon() correctly computes unsigned distance from point to polygon boundary", "done": false, "notes": ""},
        {"text": "point_in_polygon() correctly determines inside/outside using ray casting", "done": false, "notes": ""},
        {"text": "sdf_pumped() produces valid 3D SDF: negative inside inflated volume, positive outside", "done": false, "notes": ""},
        {"text": "Elliptical profile produces smooth, rounded shapes (semicircular cross-section)", "done": false, "notes": ""},
        {"text": "Flat profile produces uniform-thickness slabs with the outline shape", "done": false, "notes": ""},
        {"text": "Pointed profile produces ridge-topped shapes (linear taper from edge to center)", "done": false, "notes": ""},
        {"text": "MarchingCubes integration uses engine's existing implementation (not reimplemented)", "done": false, "notes": ""},
        {"text": "Inflation slider (0.0-1.0) controls puff amount, updating mesh on change", "done": false, "notes": ""},
        {"text": "Thickness slider (0.1-5.0) controls max Z-depth, updating mesh on change", "done": false, "notes": ""},
        {"text": "Profile dropdown/cycle switches between Elliptical, Flat, Pointed with visible difference", "done": false, "notes": ""},
        {"text": "Mesh renders with correct normals and basic lighting in editor viewport", "done": false, "notes": ""},
        {"text": "pub mod extrude added to src/game/asset_editor/mod.rs", "done": false, "notes": ""},
        {"text": "battle_arena.rs is NOT modified", "done": false, "notes": ""},
        {"text": "cargo check --bin battle_editor passes with 0 errors", "done": false, "notes": ""},
        {"text": "cargo check --bin battle_arena still passes (no regressions)", "done": false, "notes": ""}
    ],
    "verification_commands": [
        {"cmd": "test -f /home/hungaromakker/battle_tok/src/game/asset_editor/extrude.rs && echo EXISTS", "expect_contains": "EXISTS", "description": "extrude.rs file exists"},
        {"cmd": "grep -c 'ExtrudeMethod\\|PumpProfile\\|ExtrudeParams\\|Extruder' /home/hungaromakker/battle_tok/src/game/asset_editor/extrude.rs", "expect_gt": 0, "description": "Core types defined (enums, params, struct)"},
        {"cmd": "grep -c 'sdf_pumped\\|min_distance_to_polygon\\|point_in_polygon' /home/hungaromakker/battle_tok/src/game/asset_editor/extrude.rs", "expect_gt": 0, "description": "SDF function and polygon helpers implemented"},
        {"cmd": "grep -c 'MarchingCubes' /home/hungaromakker/battle_tok/src/game/asset_editor/extrude.rs", "expect_gt": 0, "description": "MarchingCubes integration present (using engine crate)"},
        {"cmd": "grep -c 'pub mod extrude' /home/hungaromakker/battle_tok/src/game/asset_editor/mod.rs", "expect_gt": 0, "description": "extrude module declared in mod.rs"},
        {"cmd": "cd /home/hungaromakker/battle_tok && cargo check --bin battle_editor 2>&1; echo EXIT:$?", "expect_contains": "EXIT:0", "description": "battle_editor compiles with extrude module"},
        {"cmd": "cd /home/hungaromakker/battle_tok && cargo check --bin battle_arena 2>&1; echo EXIT:$?", "expect_contains": "EXIT:0", "description": "battle_arena still compiles (no regressions)"}
    ],
    "checklist": [
        {"item": "Read spec.md and understand SDF-based pump/inflate algorithm", "done": false},
        {"item": "Create src/game/asset_editor/extrude.rs with ExtrudeMethod, PumpProfile, ExtrudeParams types", "done": false},
        {"item": "Define Extruder struct with mesh data, dirty flag, GPU buffers", "done": false},
        {"item": "Implement point_segment_distance() for point-to-line-segment distance", "done": false},
        {"item": "Implement min_distance_to_polygon() iterating all edges", "done": false},
        {"item": "Implement point_in_polygon() using ray casting algorithm", "done": false},
        {"item": "Implement compute_max_inradius() for outline normalization", "done": false},
        {"item": "Implement sdf_pumped() with profile-based Z-depth modulation", "done": false},
        {"item": "Implement generate_pump_mesh() using engine MarchingCubes::generate_mesh()", "done": false},
        {"item": "Implement Extruder::generate_preview() orchestrating the full pipeline", "done": false},
        {"item": "Implement Extruder::upload_to_gpu() for vertex and index buffers", "done": false},
        {"item": "Implement Extruder::render_mesh() using BlockVertex pipeline", "done": false},
        {"item": "Add pub mod extrude to asset_editor/mod.rs", "done": false},
        {"item": "Wire up Inflation slider (0.0-1.0), Thickness slider (0.1-5.0), Profile cycle (P key)", "done": false},
        {"item": "Integrate into Stage 2 with orbit camera rendering", "done": false},
        {"item": "Verify battle_arena.rs is NOT modified", "done": false},
        {"item": "Run cargo check for battle_editor and battle_arena binaries", "done": false},
        {"item": "Commit changes", "done": false}
    ],
    "worker_notes": "",
    "notes_history": [],
    "iteration": 0,
    "failed_reasons": [],
    "dependencies": ["US-P4-003"],
    "commit_hash": "",
    "files_modified": [],
    "iteration_history": [],
    "learnings": [],
    "verification_rejections": 0,
    "created_at": "2026-02-06T18:00:00Z"
}
